const Mnr=function(){let running=!1,binders=[],currentBody=null,currentTitle=null,imgList={dones:0,iter:0,elems:[]},scrollOld=0,scrollSensitivity=40,timeAddStatus=null,scrollImgOffset=500,componentsHTML=[],componentsCount=0,classBinds=[],tagBinds=[],b={},initialBinds={pageLoading:!0,windowWidth:0,windowHeight:0},start=null,loadRun=[],scrollRun=[],version="4.0";const init=(t={})=>{running||(running=!0,e("html").attr("mnr-page-loading",!0),null!=t.onLoad&&Object.values(t.onLoad).map((e=>{onLoad(null,e)})),null!=t.binds&&setBinds(t.binds),setBinds(initialBinds),window.addEventListener("scroll",handleScroll),window.addEventListener("resize",handleResize),window.addEventListener("DOMContentLoaded",finishLoad))},finishLoad=()=>{loadMedia(),1==b.pageLoading&&(console.log("MOONRISE "+version+" running"),handleScroll(),handleResize(),bindAll(),forceAllBinds(),runLoads(),b.pageLoading=!1,e("html").attr("mnr-page-loading",!1))},reload=()=>{b.pageLoading=!0,e("html").attr("mnr-page-loading",!0),finishLoad()},onLoad=(e=null,t=null)=>{null!=e&&setBinds(e),"function"==typeof t&&(loadRun.push(t),0==b.pageLoading&&runLoads())},runLoads=()=>{for(let e=0;e<loadRun.length;e++)try{loadRun[e].call(Mnr)}catch(e){console.warn("error trying to call function in loads "+e)}loadRun={}},onScroll=e=>{"function"==typeof e&&scrollRun.push(e)},runScroll=()=>{for(let e=0;e<scrollRun.length;e++)try{scrollRun[e].call(Mnr)}catch(e){console.warn("error trying to call function in scroll runs "+e)}},debounce=(e,t=500)=>{let n;return(...i)=>{clearTimeout(n),n=setTimeout((()=>{e(...i)}),t)}},bindAll=()=>{for(let t of Object.keys(b)){for(let n of e('[mnr-bind="'+t+'"]').e)if("set"!=e(n).attr("mnr-bind")){let i="innerText",r=null,l="text";switch(n.nodeName){case"INPUT":i="value",r="keyup",l=n.type,"date"==n.type?r="change":0==!!l&&(l="text");break;case"TEXTAREA":i="value",r="keyup";break;case"SELECT":i="value",r="change",e(n).hasAttr("multiple")&&(l="multiple");break;case"IMG":i="src",r=null;break;default:i="innerText",r=null}if(e(n).hasAttr("mnr-bind-attr")&&(i=e(n).attr("mnr-bind-attr")),e(n).hasAttr("mnr-bind-event")&&(r=e(n).attr("mnr-bind-event")),e(n).attr("mnr-bind-set"))if("SELECT"==n.nodeName&&"multiple"==l){let i=e("option[selected]",n).e,r=Array.from(i).map((e=>e.value));b[t]=r}else b[t]=n[i];let s=null;s=debounce("multiple"==l?i=>{let r=e("option:checked",n).e,l=Array.from(r).map((e=>e.value));b[t]=l}:e=>{b[t]=n[i]},200),null!=r&&n.addEventListener(r,s),n[i]=b[t];let o={el:n,attr:i,event:r,type:l};u.hasKey(binders,t)?!1===u.findPosByProp("el",n,binders[t].elems)&&binders[t].elems.push(o):binders[t]={elems:[o],bind:t,calls:[]},e(n).attr("mnr-bind","set")}Bind(t)}setBindClasses(),setBindTags()},Bind=t=>{let n=b[t];Object.defineProperty(b,t,{set:i=>{if(n=i,u.hasKey(binders,t))for(let n of binders[t].elems)if("multiple"==n.type){for(let t of e("option",n.el).e)t.removeAttribute("selected");for(let t of i){let i=e("option[value='"+t+"']",n.el).e[0];i&&(i.setAttribute("selected",!0),i.checked=!0)}}else n.el[n.attr]=i;0==b.pageLoading&&runAllBinds(t)},get:()=>n}),b[t]=n},forceAllBinds=()=>{runBindPrints(!0),runBindClasses(!0),runBindTags(!0)},runAllBinds=debounce((e=>{runBindPrints(),runBindClasses(),runBindTags(),runBindCalls(e)}),200),setBindClasses=()=>{for(let e of document.querySelectorAll("[mnr-class]"))e.hasAttribute("mnr-class-set")||(e.setAttribute("mnr-class",parseMnrBinds(e.getAttribute("mnr-class"),e)),e.setAttribute("mnr-class-set",!0))},runBindClasses=(force=!1)=>{if(0==b.pageLoading||1==force)for(let el of e("[mnr-class]").e){let allConds=Object.entries(JSON.parse(el.getAttribute("mnr-class")));for(let j=allConds.length-1;j>=0;j--){let temp=allConds[j];if(-1!==temp[1].indexOf("mnr-")){let e=el.getAttributeNames();e=e.sort(((e,t)=>t.length-e.length));for(let t of e)-1!==temp[1].indexOf(t)&&(temp[1]=temp[1].replaceAll(t,el.getAttribute(t)))}try{1==eval(temp[1])?el.classList.add(temp[0]):el.classList.remove(temp[0])}catch{console.warn("The evaluation "+temp[1]+" of "+el.outerHTML+" failed")}}}},runBindPrints=(t=!0)=>{if(0==b.pageLoading||1==t)for(let t of e("[mnr-print]").e)"INPUT"==t.nodeName||"SELECT"==t.nodeName||"TEXTAREA"==t.nodeName?t.value=t.getAttribute(t.getAttribute("mnr-print")):t.innerText=t.getAttribute(t.getAttribute("mnr-print"))},bindPush=(e,t)=>{if(u.hasKey(b,e)){let n=b[e];n.push(t),b[e]=n}},setBinds=e=>{if("object"==typeof e){let t=Object.entries(e);for(let e of t)b[e[0]]=e[1]}0==b.pageLoading&&bindAll()},bindCall=(e,t)=>{binders[t]?.calls.push(e)},runBindCalls=e=>{binders[e]?.calls?.map((e=>{e?.call(this)}))},setBindTags=()=>{for(let e of document.querySelectorAll("mnr"))!1===u.findPosByProp("el",e,tagBinds)&&tagBinds.push({ev:parseMnrBinds(e.innerText,e),el:e})},runBindTags=(force=!1)=>{if(0==b.pageLoading||1==force)for(let tag of tagBinds){let el=tag.el;try{tag.el.innerText=eval(tag.ev)}catch(e){tag.el.innerText="",console.warn("failed to parse <mnr> command "+e)}}},parseMnrBinds=(t,n)=>{let i="";n&&e(n).hasAttr("mnr-type")&&("number"==e(n).attr("mnr-type")&&(i="+"),e(n).removeAttr("mnr-type")),t=(t=(t=(t=(t=(t=(t=t.replaceAll(";","")).replaceAll("script","")).replaceAll("alert(","")).replaceAll(".log(","")).replaceAll(".then","")).replaceAll("try","")).replaceAll("e(this)","e(el)"),"MNR"===n.nodeName?(t=t.replaceAll("e()","e(el.parentNode)"),n.innerText=""):t=t.replaceAll("e()","e(el)"),t=t.replaceAll("e(",i+"Mnr.e(");let r=Object.keys(b);r=r.sort(((e,t)=>t.length-e.length));for(let e of r)-1!==t.indexOf(e)&&-1===t.indexOf("Mnr.b."+e)&&(t=t.replaceAll(e,i+"Mnr.b."+e));return t},handleScroll=()=>{let e=!1;(scrollOld>window.pageYOffset+scrollSensitivity||scrollOld<window.pageYOffset-scrollSensitivity)&&(e=!0),e&&(scrollOld=window.pageYOffset,runScroll())},handleResize=()=>{let t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;b.windowWidth=t,b.windowHeight=n,e("body").attr("mnr-screen-width",t),e("body").attr("mnr-screen-height",n),handleScroll()},loadMedia=()=>{for(let t of e("[mnr-src]").e)setMedia(t)},setMedia=t=>{let n=n=>{e(t).class("mnrHide"),console.warn("image skipped: "+t.src)},i=e(t).attr("mnr-src");if("set"!=i){if("IMG"==t.nodeName){if(0==e(t).hasAttr("alt")){let e=i.split("/");e=e[e.length-1],e=e.split("."),e=e.splice(0,e.length-2),t.alt=e}t.addEventListener("error",n)}e(t).setViewTrigger((function(){this.resetClasses().class("imgLoaded");let e=this.e[0];if("IMG"==e.nodeName)e.src=this.attr("mnr-src-loading");else try{this.css({"background-image":`url(${this.attr("mnr-src-loading")})`})}catch{console.warn("background image skipped: "+e.src)}this.removeAttr("mnr-src-loading")}),(function(){this.class("imgLoading anim5")}),!0),e(t).attr("mnr-src-loading",i),e(t).removeAttr("mnr-src")}},e=(e,t=document)=>{let n=[];return n="string"==typeof e?t.querySelectorAll(e):singleNode(e),{e:n,eBack:n,query:[e],singleNode:singleNode,waiting:!1,chainPos:0,waitingTotal:0,chain:[],chainWait:[],result:null,results:[],addedClasses:[],addedAttr:[],eventMethods:[],q:function(e){if("string"==typeof e){let t=[];t=this.e[0].querySelectorAll(e),this.e=t,this.query.push(e)}return this},initial:function(){return this.isWaiting(["initial",[]])||(this.e=this.eBack),this},class:function(e,t=!0){if(this.isWaiting(["class",[e,t]]))return this;let n=e.trim().split(" ");for(let e of this.e)for(let i of n)t?(0==this.hasClass(i)&&this.addedClasses.push(i),e.classList.add(i)):e.classList.remove(i);return this},toggleClass:function(e){let t=e.trim().split(" ");for(let e of this.e)for(let n of t)0==this.hasClass(n)&&this.addedClasses.push(n),e.classList.toggle(n);return this},hasClass:function(e,t=!0){let n=e.trim().split(" "),i=0,r=0;for(let e of this.e)for(let l of n){if(r++,!t)return e.classList.contains(l);e.classList.contains(l)&&i++}return i==r},resetClasses:function(){if(this.isWaiting(["resetClasses",[]]))return this;for(let e=this.addedClasses.length-1;e>=0;e--)this.class(this.addedClasses[e],!1),this.addedClasses.splice(e,1);return this},css:function(e=null){if(this.isWaiting(["css",[e]]))return this;let t=[];if(null==e||"string"==typeof e)return t=getComputedStyle(this.e[0]),null==e?t:t[e];if("object"==typeof e)for(let t of this.e)for(let n of Object.keys(e))t.style[n]=e[n];return this},attr:function(e,t=null){if(null==t)return this.e[0].getAttribute(e);for(let n of this.e)n.setAttribute(e,t),0==this.hasAttr(e)&&this.addedAttr.push(e);return this},hasAttr:function(e,t=!0){let n=e.trim().split(" "),i=0,r=0;for(let e of this.e)for(let l of n){if(r++,!t||!e.hasAttribute(l))return e.hasAttribute(l);e.hasAttribute(l)&&i++}return i==r},removeAttr:function(e){let t=e.trim().split(" ");for(let e of this.e)for(let n of t)e.removeAttribute(n);return this},resetAttrs:function(){if(this.isWaiting(["resetAttrs",[]]))return this;for(let e=this.addedAttr.length-1;e>=0;e--)this.removeAttr(this.addedAttr[e],!1),this.addedAttr.splice(e,1);return this},html:function(e=null,t=!1){if(this.isWaiting(["html",[e,t]]))return this;if(null==e)return this.e[0].innerHTML;for(let n of this.e)t?n.insertAdjacentHTML("beforeend",e):n.innerHTML=e;return bindAll(),loadMedia(),this},text:function(e=null,t=!1){if(this.isWaiting(["text",[e,t]]))return this;if(null==e)return this.e[0].innerText;for(let n of this.e)n.innerText=t?n.innerText+e:e;return this},value:function(e,t=!1){if("INPUT"==this.e[0].nodeName||"TEXTAREA"==this.e[0].nodeName||"SELECT"==this.e[0].nodeName){if(null==e)return this.e[0].value;for(let n of this.e)n.value=t?n.value+e:e}else this.text(e,t);return this},hide:function(e=!1){return this.class("mnrHide"),this},show:function(e=!1){return this.class("mnrHide",!1),this},parent:function(){return this.isWaiting(["parent",[]])||(this.e=this.singleNode(this.e[0].parentNode)),this},child:function(e=0){return this.isWaiting(["child",[e]])||("string"!=typeof e?this.e=this.singleNode(this.e[0].children[e]):this.q(e)),this},elem:function(e=0){return this.e=this.singleNode(this.e[e]),this},elems:function(){return this.e=this.eBack,this},children:function(){return this.e=this.e[0].children,this},hasElems:function(){return!!this.e.length},screenFocus:function(e=0){return u.screenTo(this.e[0],e),this},inView:function(e=0){return u.isInViewport(this.e[0],e)},aboveView:function(e=0){return u.isAboveViewport(this.e[0],e)},loadBinds:function(){return runAllBinds(),this},event:function(e,t=null){if(null!=t)for(let n of this.e)for(event of(e="string"==typeof e?e.split(" "):[e],e=u.removeDuplicate(e))){if(""==event)continue;let e=e=>{this.ev=e,t.call(this)};n.addEventListener(event,e)}return this},wait:function(e=0){return this.isWaiting(["wait",[e]])||(this.waitingTotal+=e,setTimeout((()=>{this.waiting=!1;let e=u.deepCopy(this.chainWait);for(let t=0;t<e.length&&(this.chainWait.splice(0,1),this[e[t][0]](...e[t][1]),"wait"!=e[t][0]);t++);return this}),e),this.waiting=!0),this},isWaiting:function(e){return!!this.waiting&&(this.chain.push(e),this.chainWait.push(e),!0)},run:function(e){if(this.isWaiting(["run",[e]]))return this;try{let t=this;this.result=e.call(t)}catch(e){console.warn("error trying to call function in chain "+e)}return this.results.push(this.result),this},setViewTrigger:function(e=null,t=null,n=null){for(let i of this.e){let r=(i,r)=>{i.forEach((i=>{if(i.isIntersecting){if(1==(n=null!=n&&n)&&r.unobserve(i.target),null!=e){let t=this;e.call(t)}}else if(null!=t){let e=this;t.call(e)}}))};new IntersectionObserver(r).observe(i)}return this},destroy:function(){for(let e of this.e)e.remove();return this.e=[],this.eBack=[],this}}},singleNode=function(){let e=document.createDocumentFragment().childNodes;return function(t){return Object.create(e,{0:{value:t,enumerable:!0},length:{value:1},item:{value:function(e){return this[+e||0]},enumerable:!0}})}}(),u={hasKey:function(e,t){try{return t in e}catch{return!1}},getProperties:function(e){return e?Object.getOwnPropertyNames(e):[]},getValues:function(e){let t=Object.entries(e),n=[];for(let e=0;e<t.length;e++)n.push(t[e][1]);return n},screenTo:function(t,n=0){if(window.pageYOffset,"string"==typeof t&&(t=e(t,!1).e),null==t)return;let i=e("body").e[0].getBoundingClientRect().top,r=t.getBoundingClientRect().top-i-n;window.scrollTo({top:r,behavior:"smooth"})},replaceAll:function(e,t,n){return e.replace(new RegExp(t,"g"),n)},mapValue:function(e,t,n,i,l){return e=parseFloat(e),t=parseFloat(t),n=parseFloat(n),i=parseFloat(i),l=parseFloat(l),r=(e-t)/(n-t),y=r*(l-i)+i,Math.trunc(100*y)/100},validateEmail:function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},findPosByProp:function(e,t,n){for(let i=n.length-1;i>=0;i--)if(n[i][e]==t)return i;return!1},deepCopy:function(e){let t,n,i;if("object"!=typeof e||null===e)return e;for(i in t=Array.isArray(e)?[]:{},e)n=e[i],t[i]=u.deepCopy(n);return t},cutText:function(e,t,n=!1){return e.length>=t&&(e=e.substr(0,t),1==n&&(e+="...")),e},isInViewport:function(e,t=0){let n=e.getBoundingClientRect();return n.top-t>=0&&n.top-t<=b.windowHeight||n.bottom-t<=b.windowHeight&&n.bottom-t>=0||n.top-t<=0&&n.bottom-t>=b.windowHeight&&n.bottom-t>=0},isInFullViewport:function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},isAboveViewport:function(e,t=0){let n=e.getBoundingClientRect().top-t;return b.windowHeight>=n},toCamelCase:function(e){return e.toLowerCase().replace(/(_\w)/g,(e=>e.toUpperCase().substr(1)))},suffleArray:function(e){return e.sort((()=>.5-Math.random()))},meanArray:function(e){return e.reduce(((e,t)=>e+t),0)/e.length},isDarkMode:function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches},isApple:function(){return/Mac|iPod|iPhone|iPad/.test(navigator.platform)},getUnique:function(e){return e.filter((t=>e.indexOf(t)===e.lastIndexOf(t)))},removeDuplicate:function(e){return[...new Set(e)]},getHexColor:function(){return`#${Math.random().toString(16).slice(2,8).padEnd(6,"0")}`},sanitizeHTML:function(e,t=!1){function n(e){let t=e.attributes;for(let{name:n,value:r}of t)i(n,r)&&e.removeAttribute(n)}function i(e,t){let n=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:text/html"))||!!e.startsWith("on")||void 0}let r=u.stringToHTML(e);return function(e){let t=e.querySelectorAll("script");for(let e of t)e.remove()}(r),function e(t){let i=t.children;for(let t of i)n(t),e(t)}(r),t?r.childNodes:r.innerHTML},stringToHTML:function(e){return(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body")}};return{b:b,binders:binders,init:init,reload:reload,onLoad:onLoad,onScroll:onScroll,bindCall:bindCall,debounce:debounce,bindPush:bindPush,el:null,e:e,u:u}}();
